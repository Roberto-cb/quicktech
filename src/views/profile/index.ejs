<!DOCTYPE html>
<html lang="es">
  <%- include('../partials/head', { title }) %>
  <body>
    <%- include('../partials/navbar') %>

    <main class="profile-wrap">
      <section
        class="profile-card"
        id="profileRoot"
        data-userid="<%= user && user.id ? user.id : '' %>"
        data-role="<%= user && user.role ? user.role : '' %>"
      >
        <!-- Sidebar -->
        <aside class="profile-side">
          <ul class="profile-menu" role="tablist" aria-orientation="vertical">
            <li>
              <button class="profile-tab is-active" data-tab="tab-personal" aria-selected="true">
                Datos personales
              </button>
            </li>
            <li><button class="profile-tab" data-tab="tab-cart">Carrito</button></li>
            <li><button class="profile-tab" data-tab="tab-orders">Historial de compras</button></li>
            <li><button class="profile-tab" data-tab="tab-cards">Tarjetas de crédito</button></li>

            <% if (user && user.role === 'admin') { %>
              <li>
                <button class="profile-tab" data-tab="tab-admin-products">
                  Admin: Productos
                </button>
              </li>
            <% } %>

            <li>
              <form action="/auth/logout" method="POST">
                <button class="profile-tab danger" type="submit">Cerrar sesión</button>
              </form>
            </li>
          </ul>
        </aside>

        <!-- Contenido -->
        <section class="profile-content">
          <!-- Datos personales -->
          <div id="tab-personal" class="tab-pane is-visible">
            <h2>Datos personales</h2>
            <p class="form-hint">Podés editar tus datos y guardar cambios.</p>

            <form id="personalForm" class="grid-two" novalidate>
              <div>
                <label class="label">Nombre</label>
                <input class="input" type="text" name="first_name" required />
              </div>
              <div>
                <label class="label">Apellido</label>
                <input class="input" type="text" name="last_name" required />
              </div>

              <div>
                <label class="label">DNI</label>
                <input class="input" type="text" name="dni" required />
              </div>
              <div>
                <label class="label">Edad</label>
                <input class="input" type="number" name="age" min="18" required />
              </div>

              <div class="full">
                <label class="label">Email</label>
                <input class="input" type="email" name="email" required />
              </div>

              <div>
                <label class="label">Provincia</label>
                <input class="input" type="text" name="state" required />
              </div>
              <div>
                <label class="label">Ciudad</label>
                <input class="input" type="text" name="city" required />
              </div>

              <div>
                <label class="label">Calle</label>
                <input class="input" type="text" name="street" required />
              </div>
              <div>
                <label class="label">Número</label>
                <input class="input" type="text" name="street_number" required />
              </div>

              <div class="full">
                <label class="label">Código Postal</label>
                <input class="input" type="text" name="postal_code" required />
              </div>

              <div class="full auth-actions">
                <button class="btn btn-primary" type="submit">Guardar cambios</button>
                <span id="personalMsg" class="form-hint"></span>
              </div>
            </form>
          </div>

          <!-- Carrito -->
          <div id="tab-cart" class="tab-pane">
            <h2>Carrito</h2>
            <div id="cartList" class="list-block"></div>
          </div>

          <!-- Historial -->
          <div id="tab-orders" class="tab-pane">
            <h2>Historial de compras</h2>
            <div id="ordersList" class="list-block"></div>
          </div>

          <!-- Tarjetas -->
          <div id="tab-cards" class="tab-pane">
            <h2>Tarjetas de crédito</h2>
            <p class="form-hint">Solo demostración (no funcional para pagos).</p>

            <form id="cardForm" class="grid-two">
              <div>
                <label class="label">Titular</label>
                <input class="input" type="text" name="holder" required />
              </div>
              <div>
                <label class="label">Número</label>
                <input class="input" type="text" name="number" required />
              </div>
              <div>
                <label class="label">Vencimiento</label>
                <input class="input" type="text" name="expiry" required />
              </div>
              <div>
                <label class="label">CVV</label>
                <input class="input" type="text" name="cvv" required />
              </div>
              <div class="full auth-actions">
                <button class="btn btn-primary" type="submit">Agregar tarjeta</button>
              </div>
            </form>

            <div id="cardsList" class="list-block"></div>
          </div>

          <% if (user && user.role === 'admin') { %>
            <!-- Admin: Productos -->
            <div id="tab-admin-products" class="tab-pane">
              <div class="admin-head">
                <div>
                  <h2 style="margin:0;">Admin: Productos</h2>
                  <p class="form-hint" style="margin:.25rem 0 0;">
                    CRUD manual de catálogo (solo admin).
                  </p>
                </div>
                <button class="btn btn-ghost" id="btnReloadProducts" type="button">
                  Recargar
                </button>
              </div>

              <form id="productForm" class="grid-two admin-form">
                <input type="hidden" name="id" value="" />

                <div>
                  <label class="label">Tipo</label>
                  <input class="input" name="type" required />
                </div>
                <div>
                  <label class="label">Categoría</label>
                  <input class="input" name="category" required />
                </div>

                <div>
                  <label class="label">Marca</label>
                  <input class="input" name="brand" required />
                </div>
                <div>
                  <label class="label">Modelo</label>
                  <input class="input" name="model" required />
                </div>

                <div>
                  <label class="label">Precio</label>
                  <input class="input" name="price" type="number" step="0.01" required />
                </div>
                <div>
                  <label class="label">Stock</label>
                  <input class="input" name="stock" type="number" min="0" />
                </div>

                <div class="full">
                  <label class="label">Imagen URL</label>
                  <input class="input" name="image_url" required />
                </div>

                <div class="full">
                  <label class="label">Características</label>
                  <textarea class="input" name="features" rows="3" required></textarea>
                </div>

                <div>
                  <label class="label">Dimensiones (Largo)</label>
                  <input class="input" name="dim_largo" type="number" />
                </div>
                <div>
                  <label class="label">Dimensiones (Ancho)</label>
                  <input class="input" name="dim_ancho" type="number" />
                </div>

                <div class="full">
                  <label class="label">Dimensiones (Grosor)</label>
                  <input class="input" name="dim_grosor" type="number" />
                </div>

                <div class="full admin-actions">
                  <button class="btn btn-primary" type="submit">Crear producto</button>
                  <button class="btn" id="btnCancelEdit" type="button" hidden>Cancelar edición</button>
                  <span id="productMsg" class="form-hint"></span>
                </div>
              </form>

              <div class="admin-divider"></div>

              <div class="admin-filters">
                <input class="input" id="adminSearch" placeholder="Buscar productos..." />
              </div>

              <div id="adminProductsList" class="list-block">
  <p class="form-hint">Todavía no se cargaron productos.</p>
</div>
            </div>
          <% } %>
        </section>
      </section>
    </main>

    <%- include('../partials/footer') %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/profile.js"></script>
  </body>
</html>